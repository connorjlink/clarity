var O=Object.defineProperty;var C=(e,n,t)=>n in e?O(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var o=(e,n,t)=>C(e,typeof n!="symbol"?n+"":n,t);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();class N extends HTMLElement{constructor(){super();o(this,"_messages",[]);o(this,"_visible",!0);o(this,"_endRef",null)}static get observedAttributes(){return["visible"]}get messages(){return this._messages}set messages(t){this._messages=t,this.render(),this.scrollToEnd()}get visible(){return this._visible}set visible(t){this._visible=t,this.render()}scrollToEnd(){this._endRef&&this._endRef.scrollIntoView({behavior:"smooth"})}attributeChangedCallback(t,i,s){t==="visible"&&(this.visible=s!=="false")}connectedCallback(){this.render()}render(){this.innerHTML=`
            <div class="console${this.visible?"":" fade-out"}">
                ${this._messages.map(t=>`<div class="console-line">${t.text}</div>`).join("")}
                <div id="end"></div>
            </div>
        `,this._endRef=this.querySelector("#end"),this.scrollToEnd()}}customElements.define("output-window",N);class P{constructor(n){o(this,"original");o(this,"addBuffer");o(this,"pieces");this.original=n,this.addBuffer="",this.pieces=[{buffer:"original",start:0,length:n.length}]}insert(n,t){if(t.length===0)return;const i=this.addBuffer.length;this.addBuffer+=t;let s=0,r=0;for(;r<this.pieces.length;r++){const h=this.pieces[r];if(s+h.length>=n)break;s+=h.length}if(r===this.pieces.length){this.pieces.push({buffer:"add",start:i,length:t.length});return}const l=this.pieces[r],a=n-s,c=[];a>0&&c.push({buffer:l.buffer,start:l.start,length:a}),c.push({buffer:"add",start:i,length:t.length}),a<l.length&&c.push({buffer:l.buffer,start:l.start+a,length:l.length-a}),this.pieces.splice(r,1,...c)}delete(n,t){let i=0,s=0;for(;s<this.pieces.length&&i+this.pieces[s].length<=n;)i+=this.pieces[s].length,s++;const r=s,l=n-i;let a=t;const c=[];for(;a>0&&s<this.pieces.length;){const h=this.pieces[s],f=s===r?l:0,d=h.length-f;Math.max(0,h.length-d),f>0&&c.push({buffer:h.buffer,start:h.start,length:f}),d<h.length&&c.push({buffer:h.buffer,start:h.start+f+a,length:h.length-(f+a)}),a-=d,s++}this.pieces.splice(r,s-r,...c)}getText(){let n="";for(const t of this.pieces){const i=t.buffer==="original"?this.original:this.addBuffer;n+=i.substr(t.start,t.length)}return n}}var v;(e=>{e.Error=1,e.Warning=2,e.Info=3,e.Log=4,e.Debug=5})(v||(v={}));var E;(e=>{e.File=1,e.Module=2,e.Namespace=3,e.Package=4,e.Class=5,e.Method=6,e.Property=7,e.Field=8,e.Constructor=9,e.Enum=10,e.Interface=11,e.Function=12,e.Variable=13,e.Constant=14,e.String=15,e.Number=16,e.Boolean=17,e.Array=18,e.Object=19,e.Key=20,e.Null=21,e.EnumMember=22,e.Struct=23,e.Event=24,e.Operator=25,e.TypeParameter=26})(E||(E={}));var w;(e=>{e.None=0,e.Full=1,e.Incremental=2})(w||(w={}));var T;(e=>{e.Text=1,e.Read=2,e.Write=3})(T||(T={}));var L;(e=>{e.Error=1,e.Warning=2,e.Information=3,e.Hint=4})(L||(L={}));var R;(e=>{e.Text=1,e.Method=2,e.Function=3,e.Constructor=4,e.Field=5,e.Variable=6,e.Class=7,e.Interface=8,e.Module=9,e.Property=10,e.Unit=11,e.Value=12,e.Enum=13,e.Keyword=14,e.Snippet=15,e.Color=16,e.File=17,e.Reference=18,e.Folder=19,e.EnumMember=20,e.Constant=21,e.Struct=22,e.Event=23,e.Operator=24,e.TypeParameter=25})(R||(R={}));function p(e){let n="";return e.childNodes.forEach((t,i,s)=>{t.nodeType===Node.TEXT_NODE?n+=t.data:t.tagName==="BR"?n+=`
`:t.tagName==="DIV"?(n+=p(t),i<s.length-1&&(n+=`
`)):t.nodeType===Node.ELEMENT_NODE&&(n+=p(t))}),n}function M(e){let n=0;const t=window.getSelection();if(t&&t.rangeCount>0){const i=t.getRangeAt(0),s=i.cloneRange();s.selectNodeContents(e),s.setEnd(i.endContainer,i.endOffset),n=s.toString().length}return n}function m(e,n){const t=window.getSelection();if(!t)return;let i=0,s=[e],r,l=!1;for(;s.length&&!l&&(r=s.pop(),!!r);)if(r.nodeType===Node.TEXT_NODE){const a=r.length;if(i+a>=n){const c=document.createRange();c.setStart(r,n-i),c.collapse(!0),t.removeAllRanges(),t.addRange(c),l=!0}else i+=a}else{let a=Array.from(r.childNodes);for(let c=a.length-1;c>=0;c--)s.push(a[c])}}class B extends HTMLElement{constructor(){super();o(this,"_pieceTable");o(this,"_consoleListener",null);o(this,"_inputRef",null);o(this,"_highlightRef",null);o(this,"_sourceUri","");o(this,"_lastText","");o(this,"_client",null);o(this,"_hasInitialized",!1);o(this,"_boundInputCallback",this.inputCallback.bind(this));o(this,"_boundScrollCallback",this.scrollCallback.bind(this));o(this,"_boundKeydownCallback",this.keydownCallback.bind(this));this._pieceTable=new P("function nvr main = () {}")}connectedCallback(){}disconnectedCallback(){var t;(t=this._client)==null||t.postMessage({type:"execute",method:"closeDocument",params:{uri:this._sourceUri}})}initialize(t,i,s){var r;this._hasInitialized=!0,this._consoleListener||(this._consoleListener=i),s&&(this._client=s,this._client.addEventListener("message",l=>{var a,c,h;l.data.type==="log"?(a=this._consoleListener)==null||a.notify(l.data.message):l.data.type==="error"?(c=this._consoleListener)==null||c.notify(l.data.message):l.data.type==="compileResult"&&((h=this._consoleListener)==null||h.notify(JSON.stringify(l.data.result)))}),this._client.addEventListener("messageerror",l=>{var a;(a=this._consoleListener)==null||a.notify(l.data)}),this._sourceUri=t),(r=this._client)==null||r.postMessage({type:"execute",method:"openDocument",params:{uri:this._sourceUri,sourceCode:this._pieceTable.getText()}}),this.render()}inputCallback(t){this.handleInputChange(t)}scrollCallback(t){this.syncScroll()}keydownCallback(t){this.handleKeyDown(t)}attachEventListeners(){var t,i,s;(t=this._inputRef)==null||t.addEventListener("input",this._boundInputCallback),(i=this._inputRef)==null||i.addEventListener("scroll",this._boundScrollCallback),(s=this._inputRef)==null||s.addEventListener("keydown",this._boundKeydownCallback)}detachEventListeners(){var t,i,s;(t=this._inputRef)==null||t.removeEventListener("input",this._boundInputCallback),(i=this._inputRef)==null||i.removeEventListener("scroll",this._boundScrollCallback),(s=this._inputRef)==null||s.removeEventListener("keydown",this._boundKeydownCallback)}handleInputChange(t){if(!this._inputRef)return;const i=p(this._inputRef),s=M(this._inputRef);let r=0;for(;r<this._lastText.length&&r<i.length&&this._lastText[r]===i[r];)r++;let l=this._lastText.length-1,a=i.length-1;for(;l>=r&&a>=r&&this._lastText[l]===i[a];)l--,a--;l>=r&&this._pieceTable.delete(r,l-r+1),a>=r&&this._pieceTable.insert(r,i.slice(r,a+1)),this._lastText=i,this.renderHighlight([]),m(this._inputRef,s)}handleKeyDown(t){t.key==="Tab"&&(t.preventDefault(),document.execCommand("insertText",!1,"    ")),t.key==="Enter"&&(t.preventDefault(),document.execCommand("insertLineBreak"))}renderHighlight(t){var i;this._highlightRef&&(this._pieceTable.getText(),(i=this._client)==null||i.postMessage({type:"execute",method:"recycle",params:{uri:this._sourceUri,deltas:t}}))}syncScroll(){this._inputRef&&this._highlightRef&&(this._highlightRef.scrollTop=this._inputRef.scrollTop,this._highlightRef.scrollLeft=this._inputRef.scrollLeft)}render(){if(!this._hasInitialized)throw new Error("call initialize() on SourceEditorElement before rendering.");const t=this._pieceTable.getText();this.innerHTML=`
            <div class="editor-shell">
                <pre class="highlight-layer"></pre>
                <div class="input-layer" contenteditable="true" spellcheck="false"></div>
            </div>
        `,this._highlightRef=this.querySelector(".highlight-layer"),this._inputRef=this.querySelector(".input-layer"),this._inputRef&&(this._inputRef.textContent=t,this._lastText=t),this.attachEventListeners(),this.renderHighlight([])}}customElements.define("source-editor",B);const u=document.getElementById("output-window");u.messages=[];u.visible=!1;var g;const W=()=>{u.visible=!0,g&&clearTimeout(g.current),g=setTimeout(()=>u.visible=!1,1e4)},U={notify:e=>{console.log(e),u.messages=[...u.messages,{id:Date.now().toString(),text:e,visible:!0}],W()}},D=new Worker(new URL("/clarity/assets/language_server_worker-BOXhEwlU.js",import.meta.url),{type:"module"}),y=new Worker(new URL("/clarity/assets/language_client_worker-2arvf2PA.js",import.meta.url),{type:"module"}),k=new MessageChannel,_=k.port1,b=k.port2;D.postMessage({type:"connect",port:_},[_]);y.postMessage({type:"connect",port:b},[b]);_.start();b.start();const x=document.querySelector("#main-editor");x.attachEventListeners();x.initialize("file:///c:/Users/Connor/Desktop/clarity/src/index.ts",U,y);
