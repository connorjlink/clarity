var x=Object.defineProperty;var m=(e,i,t)=>i in e?x(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var c=(e,i,t)=>m(e,typeof i!="symbol"?i+"":i,t);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();class C extends HTMLElement{constructor(){super();c(this,"_messages",[]);c(this,"_visible",!0);c(this,"_endRef",null)}static get observedAttributes(){return["visible"]}get messages(){return this._messages}set messages(t){this._messages=t,this.render(),this.scrollToEnd()}get visible(){return this._visible}set visible(t){this._visible=t,this.render()}scrollToEnd(){this._endRef&&this._endRef.scrollIntoView({behavior:"smooth"})}attributeChangedCallback(t,n,s){t==="visible"&&(this.visible=s!=="false")}connectedCallback(){this.render()}render(){this.innerHTML=`
            <div class="console${this.visible?"":" fade-out"}">
                ${this._messages.map(t=>`<div class="console-line">${t.text}</div>`).join("")}
                <div id="end"></div>
            </div>
        `,this._endRef=this.querySelector("#end"),this.scrollToEnd()}}customElements.define("output-window",C);class N{constructor(i){c(this,"original");c(this,"addBuffer");c(this,"pieces");this.original=i,this.addBuffer="",this.pieces=[{buffer:"original",start:0,length:i.length}]}insert(i,t){if(t.length===0)return;const n=this.addBuffer.length;this.addBuffer+=t;let s=0,r=0;for(;r<this.pieces.length;r++){const h=this.pieces[r];if(s+h.length>=i)break;s+=h.length}if(r===this.pieces.length){this.pieces.push({buffer:"add",start:n,length:t.length});return}const l=this.pieces[r],a=i-s,o=[];a>0&&o.push({buffer:l.buffer,start:l.start,length:a}),o.push({buffer:"add",start:n,length:t.length}),a<l.length&&o.push({buffer:l.buffer,start:l.start+a,length:l.length-a}),this.pieces.splice(r,1,...o)}delete(i,t){let n=0,s=0;for(;s<this.pieces.length&&n+this.pieces[s].length<=i;)n+=this.pieces[s].length,s++;const r=s,l=i-n;let a=t;const o=[];for(;a>0&&s<this.pieces.length;){const h=this.pieces[s],g=s===r?l:0,_=h.length-g;Math.max(0,h.length-_),g>0&&o.push({buffer:h.buffer,start:h.start,length:g}),_<h.length&&o.push({buffer:h.buffer,start:h.start+g+a,length:h.length-(g+a)}),a-=_,s++}this.pieces.splice(r,s-r,...o)}getText(){let i="";for(const t of this.pieces){const n=t.buffer==="original"?this.original:this.addBuffer;i+=n.substr(t.start,t.length)}return i}}var T;(e=>{e.Error=1,e.Warning=2,e.Info=3,e.Log=4,e.Debug=5})(T||(T={}));var E;(e=>{e.File=1,e.Module=2,e.Namespace=3,e.Package=4,e.Class=5,e.Method=6,e.Property=7,e.Field=8,e.Constructor=9,e.Enum=10,e.Interface=11,e.Function=12,e.Variable=13,e.Constant=14,e.String=15,e.Number=16,e.Boolean=17,e.Array=18,e.Object=19,e.Key=20,e.Null=21,e.EnumMember=22,e.Struct=23,e.Event=24,e.Operator=25,e.TypeParameter=26})(E||(E={}));var w;(e=>{e.None=0,e.Full=1,e.Incremental=2})(w||(w={}));var y;(e=>{e.Text=1,e.Read=2,e.Write=3})(y||(y={}));var R;(e=>{e.Error=1,e.Warning=2,e.Information=3,e.Hint=4})(R||(R={}));var L;(e=>{e.Text=1,e.Method=2,e.Function=3,e.Constructor=4,e.Field=5,e.Variable=6,e.Class=7,e.Interface=8,e.Module=9,e.Property=10,e.Unit=11,e.Value=12,e.Enum=13,e.Keyword=14,e.Snippet=15,e.Color=16,e.File=17,e.Reference=18,e.Folder=19,e.EnumMember=20,e.Constant=21,e.Struct=22,e.Event=23,e.Operator=24,e.TypeParameter=25})(L||(L={}));function v(e){let i="";return e.childNodes.forEach((t,n,s)=>{t.nodeType===Node.TEXT_NODE?i+=t.data:t.tagName==="BR"?i+=`
`:t.tagName==="DIV"?(i+=v(t),n<s.length-1&&(i+=`
`)):t.nodeType===Node.ELEMENT_NODE&&(i+=v(t))}),i}function O(e){let i=0;const t=window.getSelection();if(t&&t.rangeCount>0){const n=t.getRangeAt(0),s=n.cloneRange();s.selectNodeContents(e),s.setEnd(n.endContainer,n.endOffset),i=s.toString().length}return i}function P(e,i){const t=window.getSelection();if(!t)return;let n=0,s=[e],r,l=!1;for(;s.length&&!l&&(r=s.pop(),!!r);)if(r.nodeType===Node.TEXT_NODE){const a=r.length;if(n+a>=i){const o=document.createRange();o.setStart(r,i-n),o.collapse(!0),t.removeAllRanges(),t.addRange(o),l=!0}else n+=a}else{let a=Array.from(r.childNodes);for(let o=a.length-1;o>=0;o--)s.push(a[o])}}class M extends HTMLElement{constructor(){super();c(this,"_pieceTable");c(this,"_consoleListener",null);c(this,"_inputRef",null);c(this,"_highlightRef",null);c(this,"_sourceUri","");c(this,"_lastText","");c(this,"_clientPort",null);c(this,"_hasInitialized",!1);c(this,"_boundInputCallback",this.inputCallback.bind(this));c(this,"_boundScrollCallback",this.scrollCallback.bind(this));c(this,"_boundKeydownCallback",this.keydownCallback.bind(this));this._pieceTable=new N("function nvr main = () {}")}connectedCallback(){var t;this.render(),(t=this._clientPort)==null||t.postMessage({type:"execute",method:"openDocument",params:{uri:this._sourceUri,sourceCode:this._pieceTable.getText()}})}disconnectedCallback(){var t;(t=this._clientPort)==null||t.postMessage({type:"execute",method:"closeDocument",params:{uri:this._sourceUri}})}initialize(t,n,s){this._hasInitialized=!0,this._consoleListener||(this._consoleListener=n),s&&(this._clientPort=s,this._clientPort.onmessage=r=>{var l,a,o;r.data.type==="log"?(l=this._consoleListener)==null||l.notify(r.data.message):r.data.type==="error"?(a=this._consoleListener)==null||a.notify(`Error: ${r.data.message}`):r.data.type==="compileResult"&&((o=this._consoleListener)==null||o.notify(`Compile result: ${JSON.stringify(r.data.result)}`))},this._clientPort.onmessageerror=r=>{var l;(l=this._consoleListener)==null||l.notify(`Worker error: ${r.data}`)},this._sourceUri=t,this._clientPort.postMessage({type:"execute",method:"openDocument",params:{uri:this._sourceUri,sourceCode:this._pieceTable.getText()}}))}inputCallback(t){this.handleInputChange(t)}scrollCallback(t){this.syncScroll()}keydownCallback(t){this.handleKeyDown(t)}attachEventListeners(){var t,n,s;(t=this._inputRef)==null||t.addEventListener("input",this._boundInputCallback),(n=this._inputRef)==null||n.addEventListener("scroll",this._boundScrollCallback),(s=this._inputRef)==null||s.addEventListener("keydown",this._boundKeydownCallback)}detachEventListeners(){var t,n,s;(t=this._inputRef)==null||t.removeEventListener("input",this._boundInputCallback),(n=this._inputRef)==null||n.removeEventListener("scroll",this._boundScrollCallback),(s=this._inputRef)==null||s.removeEventListener("keydown",this._boundKeydownCallback)}handleInputChange(t){if(!this._inputRef)return;const n=v(this._inputRef),s=O(this._inputRef);let r=0;for(;r<this._lastText.length&&r<n.length&&this._lastText[r]===n[r];)r++;let l=this._lastText.length-1,a=n.length-1;for(;l>=r&&a>=r&&this._lastText[l]===n[a];)l--,a--;l>=r&&this._pieceTable.delete(r,l-r+1),a>=r&&this._pieceTable.insert(r,n.slice(r,a+1)),this._lastText=n,this.renderHighlight(),P(this._inputRef,s)}handleKeyDown(t){t.key==="Tab"&&(t.preventDefault(),document.execCommand("insertText",!1,"    ")),t.key==="Enter"&&(t.preventDefault(),document.execCommand("insertLineBreak"))}renderHighlight(){var t;if(this._highlightRef){this._pieceTable.getText();const n=[];(t=this._clientPort)==null||t.postMessage({type:"execute",method:"recycle",params:{uri:this._sourceUri,deltas:n}})}}syncScroll(){this._inputRef&&this._highlightRef&&(this._highlightRef.scrollTop=this._inputRef.scrollTop,this._highlightRef.scrollLeft=this._inputRef.scrollLeft)}render(){if(!this._hasInitialized)throw new Error("call initialize() on SourceEditorElement before rendering.");const t=this._pieceTable.getText();this.innerHTML=`
            <div class="editor-shell">
                <pre class="highlight-layer"></pre>
                <div class="input-layer" contenteditable="true" spellcheck="false"></div>
            </div>
        `,this._highlightRef=this.querySelector(".highlight-layer"),this._inputRef=this.querySelector(".input-layer"),this._inputRef&&(this._inputRef.textContent=t,this._lastText=t),this.renderHighlight(),this.attachEventListeners()}}customElements.define("source-editor",M);const f=document.getElementById("output-window");f.messages=[{id:"1",text:"Hola mundo",visible:!0},{id:"2",text:"Mensaje 2",visible:!0}];f.visible=!0;var b;const W=()=>{f.visible=!0,b&&clearTimeout(b.current),b=setTimeout(()=>f.visible=!1,3e3)},u={notify:e=>{console.log(e),f.messages=[...f.messages,{id:Date.now().toString(),text:e,visible:!0}],W()}},B=new Worker(new URL("/assets/language_server_worker-BGmqrwY2.js",import.meta.url),{type:"module"}),p=new Worker(new URL("/assets/language_client_worker-nmTfpNi6.js",import.meta.url),{type:"module"}),d=new MessageChannel;B.postMessage({type:"connect",port:d.port1},[d.port1]);p.postMessage({type:"connect",port:d.port2},[d.port2]);p.onmessage=e=>{const i=e.data;i.type==="log"?u.notify(i.message):i.type==="error"?u.notify(`Error: ${i.message}`):i.type==="compileResult"&&u.notify(`Compile result: ${JSON.stringify(i.result)}`)};p.onerror=e=>{u.notify(`Worker error: ${e.message}`)};p.onmessageerror=e=>{u.notify(`Message error: ${e.data}`)};const k=document.querySelector("#main-editor");k.attachEventListeners();k.initialize("file:///c:/Users/Connor/Desktop/clarity/src/index.ts",u,d.port2);
