var F=Object.defineProperty;var U=(l,r,b)=>r in l?F(l,r,{enumerable:!0,configurable:!0,writable:!0,value:b}):l[r]=b;var y=(l,r,b)=>U(l,typeof r!="symbol"?r+"":r,b);(function(){"use strict";var l;(e=>{e.Error=1,e.Warning=2,e.Info=3,e.Log=4,e.Debug=5})(l||(l={}));var r;(e=>{e.File=1,e.Module=2,e.Namespace=3,e.Package=4,e.Class=5,e.Method=6,e.Property=7,e.Field=8,e.Constructor=9,e.Enum=10,e.Interface=11,e.Function=12,e.Variable=13,e.Constant=14,e.String=15,e.Number=16,e.Boolean=17,e.Array=18,e.Object=19,e.Key=20,e.Null=21,e.EnumMember=22,e.Struct=23,e.Event=24,e.Operator=25,e.TypeParameter=26})(r||(r={}));var b;(e=>{e.None=0,e.Full=1,e.Incremental=2})(b||(b={}));var x;(e=>{e.Text=1,e.Read=2,e.Write=3})(x||(x={}));var k;(e=>{e.Error=1,e.Warning=2,e.Information=3,e.Hint=4})(k||(k={}));var E;(e=>{e.Text=1,e.Method=2,e.Function=3,e.Constructor=4,e.Field=5,e.Variable=6,e.Class=7,e.Interface=8,e.Module=9,e.Property=10,e.Unit=11,e.Value=12,e.Enum=13,e.Keyword=14,e.Snippet=15,e.Color=16,e.File=17,e.Reference=18,e.Folder=19,e.EnumMember=20,e.Constant=21,e.Struct=22,e.Event=23,e.Operator=24,e.TypeParameter=25})(E||(E={}));function v(e,s,t=null){return{jsonrpc:"2.0",method:e,params:s,id:t}}class T{constructor(){y(this,"symbols");y(this,"lastSynchronized",null);y(this,"lastRecycled",null);this.symbols=new Map}lookup(s,t,o){const a=this.symbols.get(s);if(a&&a.location&&a.location.range.start.line===t&&a.location.range.start.character===o)return a}addSymbol(s,t){this.symbols.set(s,t)}getSymbol(s){return this.symbols.get(s)}hasSymbol(s){return this.symbols.has(s)}removeSymbol(s){return this.symbols.delete(s)}getAllSymbols(){return Array.from(this.symbols.values())}clear(){this.symbols.clear()}}function R(e){switch(e){case r.File:case r.String:case r.Package:return"string";case r.Module:case r.Array:return"plain-text";case r.Namespace:return"namespace";case r.Class:case r.Struct:return"class-type";case r.Method:return"function-templated";case r.Property:case r.Field:return"field";case r.Constructor:return"function-templated";case r.Enum:case r.Interface:return"class-type-templated";case r.Function:return"function";case r.Variable:return"local-variable";case r.Constant:return"static-field";case r.Number:return"integer-literal";case r.Boolean:case r.Null:return"keyword";case r.Object:return"global-variable";case r.Key:case r.EnumMember:return"enum-member";case r.Event:return"static-method";case r.Operator:return"operator";case r.TypeParameter:return"template-parameter";default:return"plain-text"}}function D(e){switch(e.toLowerCase()){case"hz":return"haze";case"hza":return"hazea";case"hzi":return"hazei";case"hzs":return"hazes";default:return"plaintext"}}function $(e){switch(e){case l.Error:return"error";case l.Warning:return"warning";case l.Info:return"info";case l.Log:return"log";case l.Debug:return"debug";default:return"log"}}const f=class f{constructor(s,t){y(this,"documents",new Map);y(this,"promises",new Map);y(this,"database");y(this,"serverPort");var o;this.database=s,this.serverPort=t,(o=this.serverPort)==null||o.postMessage(v("initialize",{processId:null,clientInfo:{name:"clarity"},capabilities:{textDocument:{synchronization:{dynamicRegistration:!1,willSave:!1,willSaveWaitUntil:!1,didSave:!0},definition:{dynamicRegistration:!1},typeDefinition:{dynamicRegistration:!1},hover:{dynamicRegistration:!1,contentFormat:["plaintext","markdown"]},completion:{dynamicRegistration:!1,completionItem:{snippetSupport:!0,commitCharactersSupport:!0,documentationFormat:["plaintext","markdown"],deprecatedSupport:!0,preselectSupport:!0,insertReplaceSupport:!0,resolveSupport:{properties:["documentation","detail","additionalTextEdits"]}},contextSupport:!0,completionItemKind:{valueSet:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]},triggerCharacters:[".","(","[","{"]},documentSymbol:{dynamicRegistration:!1,symbolKind:{valueSet:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]}},documentHighlight:{dynamicRegistration:!1},references:{dynamicRegistration:!1},semanticTokens:{dynamicRegistration:!1,requests:{range:!1,full:!0},tokenTypes:["file","module","namespace","package","class","method","property","field","constructor","enum","interface","function","variable","constant","string","number","boolean","array","object","key","null","enumMember","struct","event","operator","typeParameter"],tokenModifiers:["signed","unsigned","mutable","immutable","value","ptr","nvr","struct","string","qword","dword","word","byte"]}},workspace:{workspaceFolders:!0,symbol:{dynamicRegistration:!1},didChangeConfiguration:{dynamicRegistration:!1},didChangeWatchedFiles:{dynamicRegistration:!1}},window:{showMessage:{messageActionItem:{additionalPropertiesSupport:!1}},logMessage:{}}}}))}execute(s,...t){const o=this[s];if(typeof o=="function")return o.apply(this,t);throw new Error(`Method "${s}" does not exist on type LanguageClient.`)}onMessage(s){var o,a,u,c,g;const t=JSON.parse(s.toString());if("jsonrpc"in t&&t.jsonrpc==="2.0"){if("error"in t&&t.error){postMessage({type:"error",message:`language server error: ${t.error.message} (code: ${t.error.code})`});return}if("method"in t){switch(t.method){case"window/showMessage":const n=(o=t.params)==null?void 0:o.type,i=(a=t.params)==null?void 0:a.message;if(n&&i){const P=$(n);postMessage({type:P,message:i})}break;case"window/logMessage":const p=(u=t.params)==null?void 0:u.type,d=(c=t.params)==null?void 0:c.message;if(p&&d)switch(p){case l.Error:console.error(`server error: ${d}`);break;case l.Warning:console.warn(`server warning: ${d}`);break;case l.Info:console.info(`server info: ${d}`);break;case l.Log:console.log(`server log: ${d}`);break;case l.Debug:console.debug(`server debug: ${d}`);break}break;case"textDocument/publishDiagnostics":postMessage({type:"diagnostics",diagnostics:t.params});break;default:postMessage({type:"log",message:`notification received: ${t.method}`});break}return}const m=(g=t.id)==null?void 0:g.toString();if(m&&"result"in t){const n=this.promises.get(m);if(n){clearTimeout(n.timeout),n.resolve(t.result),this.promises.delete(m);return}}return}postMessage({type:"error",message:"language client error: invalid server response"})}onError(s){postMessage({type:"error",message:`language server error: ${s.message}`})}onMessageError(s){postMessage({type:"error",message:`language server message error: ${s.data}`})}async requestFileDialog(s){const t=document.createElement("input");t.type="file",t.accept=".hz",t.style.display="none",t.onchange=o=>{const a=o.target.files;if(a&&a.length>0){const u=new FileReader;u.onload=c=>{var m;const g=(m=c.target)==null?void 0:m.result;this.invalidate(g,s)},u.readAsText(a[0])}},document.body.appendChild(t),t.click(),document.body.removeChild(t)}async openDocument(s,t){var p;postMessage({type:"log",message:`initializing document "${s}"...`});const o=new URL(s),c=decodeURIComponent(o.pathname).split("/").pop()??"",g=c.lastIndexOf("."),m=g!==-1?c.substring(g+1):"",n=D(m),i={uri:s,languageId:n,version:1,sourceCode:t,deltas:[]};(p=this.serverPort)==null||p.postMessage(v("textDocument/didOpen",{textDocument:i},null)),this.documents.set(s,i)}closeDocument(s){var t;postMessage({type:"log",message:`closing document "${s}"...`}),(t=this.serverPort)==null||t.postMessage(v("textDocument/didClose",{textDocument:{uri:s}},null)),this.documents.delete(s)}async recycle(s,t){var u;const o=new Date,a=this.database.lastRecycled?o.getTime()-this.database.lastRecycled.getTime():0;if(!this.database.lastRecycled||a>1500){postMessage({type:"log",message:`synchronizing symbol database... (${a}ms since last recycle)`});const c=crypto.randomUUID(),g=new Promise((n,i)=>{const p=setTimeout(()=>{this.promises.delete(c),postMessage({type:"error",message:"timeout waiting for recycle response"})},f.REQUEST_TIMEOUT);this.promises.set(c,{resolve:n,reject:i,timeout:p})}),m=this.documents.get(s);if(m)postMessage({type:"log",message:`recycling document "${s}"...`}),m.deltas=t,(u=this.serverPort)==null||u.postMessage(v("textDocument/didChange",{textDocument:{uri:"file:///c:/Users/Connor/Desktop/clarity/src/markup_generator.ts",version:m.version++},contentChanges:t},c));else throw new Error(`document "${s}" does not exist in the client.`);await g}}async invalidate(s,t){var c;const o=new Date,a=this.database.lastSynchronized?o.getTime()-this.database.lastSynchronized.getTime():0,u=crypto.randomUUID();if(!this.database.lastSynchronized||a>1500){postMessage({type:"log",message:`synchronizing symbol database... (${a}ms since last invalidation)`});const g="Timeout waiting for invalidate() response",m=new Promise((n,i)=>{const p=window.setTimeout(()=>{this.promises.delete(u),postMessage({type:"error",message:g}),i(new Error(g))},f.REQUEST_TIMEOUT);this.promises.set(u,{resolve:n,reject:i,timeout:p})});(c=this.serverPort)==null||c.postMessage(v("textDocument/didSave",{textDocument:{uri:s},text:t},u)),await m}}generateMarkup(s){const t=[],o=/[A-Za-z_][A-Za-z0-9_]*/y;let a=0,u=1,c=1;for(;a<s.length;){const n=s[a];o.lastIndex=a;const i=o.exec(s);if(i){const[p]=i;t.push({text:p,start:a,end:a+p.length,line:u,column:c,isSymbol:!0});for(let d=0;d<p.length;d++)s[a+d]===`
`?(u++,c=1):c++;a+=p.length;continue}t.push({text:n,start:a,end:a+1,line:u,column:c,isSymbol:!1}),n===`
`?(u++,c=1):c++,a++}let g=[""];for(const n of t){let i="";if(n.isSymbol){const d=this.database.lookup(n.text,n.line,n.column);d?i=`<span class="${R(d.kind)}">${f.escapeHtml(n.text)}</span>`:i=f.escapeHtml(n.text)}else i=f.escapeHtml(n.text);const p=i.split(`
`);g[g.length-1]+=p[0];for(let d=1;d<p.length;d++)g.push(p[d]);n.text===`
`&&g.push("")}const m=g.map((n,i)=>`<code id="line${i}">${n}</code>`).join("");return f.formatMarkup(m)}static formatMarkup(s){return`${s}`}static escapeHtml(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/<=/g,"&le;").replace(/>/g,"&gt;").replace(/>=/g,"&ge;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}};y(f,"REQUEST_TIMEOUT",5e3);let M=f,w=null,h=null;self.onmessage=e=>{var s,t;if(((s=e.data)==null?void 0:s.type)==="connect"&&e.data.port)w=e.data.port,w&&(w.onmessage=o=>{h==null||h.onMessage(o.data)},w.onmessageerror=o=>{console.error("language client message receive error:",o),h==null||h.onError(o.data)});else if(((t=e.data)==null?void 0:t.type)==="execute"){const o=e.data.method,a=e.data.params;h&&o&&a?h.execute(o,...Object.values(a)):console.error("invalid client execute method request:",e.data)}};var z=new T;h=new M(z,w)})();
